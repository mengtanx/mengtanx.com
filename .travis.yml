# https://docs.travis-ci.com/user/deployment/pages/
# https://docs.travis-ci.com/user/languages/python/
language: python

python:
    - "3.6"

branches:
  only:
    - gh-pages

install:
    # install latest release version
    - wget -qO- https://api.github.com/repos/gohugoio/hugo/releases/latest | sed -r -n '/browser_download_url/{/Linux-64bit.deb/{s@[^:]*:[[:space:]]*"([^"]*)".*@\1@g;p}}' | xargs wget
    - sudo dpkg -i hugo*.deb
    - pip install Pygments
    - rm -rf public 2> /dev/null

script:
    - hugo
    - echo 'www.mengtanx.com' > public/CNAME

after_script:
  - cd "$TRAVIS_BUILD_DIR"
  - cp README.md public/
  - cd public
  - git init
  - git add .
  - git -c user.name="mengtanx" -c user.email="mengtanx@gmail.com" commit -m "Automatic Deployment"
  - git push -f -q https://${GitHUB_NAME}:${GITHUB_TOKEN}@github.com/mengtanx/mengtanx.com.git master
  - cd "$TRAVIS_BUILD_DIR"